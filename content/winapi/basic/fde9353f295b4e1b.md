Как использовать WinAPI?
========================

::: {.date}
01.01.2007
:::

WinAPI - это те функции которыми управляется работа приложений в
Windows. Они являются частью системы, и подгружаются вместе с виндос в
библиотеке kernel32.dll.

В Делфи эти функции приемущественно описанны в библиотеке Windows,
которая автоматически включается в ваш новый проект. Вы можете открыть
эту библиотеку и посмотреть сами. Большая часть VCL - это надстройка над
WinAPI.

Для каждого запущенного приложения создается процесс и в этом процессе
основной поток (приложение может создавать свои дополнитльные потоки -
все они будут принадлежать его процессу), а уж потоки создают окна.
Каждый поток имеет уникальный числовой индификатор называемый ThreadID.
Это просто целое число которое дается (ассоциируется) этому потоку.
Точно так же имеет свой уникальный индификатор каждое окно в системе,
называемый Handle. Он обозначается обычно типом HWND, но это просто
целое. 4-х байтное.

В виндосе взаимодействие построено на сообщениях. Сообщени - это
небольшой набор данных (record, условно говоря), который содержит:

Handle - Handle окна, которому сообщение предназначается.

Message - целое число, которое указывает, что же это за сообщение. Для
системных сообщений определены константы типа WM\_KEYPRESSED,
WM\_MOUSEMOVE и т. д. Их значение(числовое) совершенно никого не
интересует однако его легко узнать: ShowMessage(\'WM\_MOUSEMOVE:
\'+IntToStr(WM\_MOUSEMOVE));

wParam - целое, значение зависит от сообщения

lParaw - целое, значение зависит от сообщения.

Для каждого потока отводиться специальное место в памяти, куда
складываются сообщение по мере из поступления - называется это очередью
сообщений. Сами окна сообщения не получают - все они складываются в
очередь потока. Чтобы достать следующее сообщение, используется функция
GetMessage(PeekMessage). Если вы хотите доставить сообщение окну, то
проще всего это сделать вызвав DispatchMessage передав в качестве
параметра полученное сообшение. Эта функция находит нужное окно в вашем
потоке, и вызывает WindowsProc - процедура окна, которое должна
обработать это сообщение. Адрес этой процедуры (для каждого окна свой)
известен системе - он передается ей во время регистрации окна.

Пракически каждое приложение осуществляет цикл обработки сообщений. То
есть цикл, который вызывает GetMessage и обрабатывает сообщение
(рассылает окнам), пока не попадется сообщение WM\_QUIT, после чего
приложение должно завершить работу. В Delphi этот цикл представлен в
методе Application.Run

Автор: Fantasist

Взято с Vingrad.ru <https://forum.vingrad.ru>
