---
Title: Работа с листами книги
Author: Евгений Старостин
Date: 01.01.2007
---


Работа с листами книги
======================

::: {.date}
01.01.2007
:::

Есть в VBA одна вещь, которая меня раздражает. Это ActiveSheet и
ActiveWorkbook, а также возможность работы с Cells и Range без указания,
к какому листу или книге они принадлежат. Одно время я боролся сам с
собой, то применяя, то совсем отказываясь от подобных конструкций.
Окончательно я отказался от этого лишь после обнаружения многочисленных
ошибок в анализе «лога» моего Web-сервера, который я сделал на VBA.
Благо, при работе в Delphi нет возможности написать Cells(x, y) =
NewValue, подразумевая при этом какой-то неуловимый ActiveSheet. Поэтому
прежде, чем работать с отдельными ячейками, я всегда получаю интерфейс
на конкретный и вполне осязаемый лист книги. И делю это так:

    var ISheet: Excel8TLB._Worksheet;
    …
    ISheet := IWorkbook.Worksheets.Item['Лист1'] as Excel8TLB._Worksheet;

Коллекция Worksheet подобна всем остальным коллекциям из Excel TLB. В
ней вы можете удалять листы, вставлять новые, изменять их порядок. Но я
практически никогда не делаю этого, поэтому всех нетерпеливых снова
отсылаю к справке по Excel VBA.

Главную же мысль свою повторю еще раз. Всегда и везде рекомендую
работать с ячейками и областями в контексте их листа, получив
предварительно интерфейс на этот лист вышеописанным способом. От
использования свойств ActiveSheet и ActiveWorkbook можно совсем
отказаться, разве что за исключением каких-то особых случаев.

Автор: Евгений Старостин

Взято с сайта <https://www.delphikingdom.ru/>
