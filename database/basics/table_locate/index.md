---
Title: Поиск нужных данных
Date: 01.01.2007
---


Поиск нужных данных
===================

::: {.date}
01.01.2007
:::

Теперь разберём более эффективные способы нахождения нужной записи
в таблице.

А если нам надо перейти к вполне конкретной строке (записи)? Можно
конечно организовать такой цикл и найти нужную запись, но это громоздко,
неудобно, и главное очень медлено! Для этого можно использовать метод таблицы
Locate.

Например в нашей задаче нам надо найти запись где в поле Category
значение "Cod". Этого можно добится примерно следующим кодом:

    Table1.Locate('Category','Cod',[loCaseInsensitive]);

Можно "повесить" этот код на кнопку и убедится, что после выполнения
этого кода активная запись стала именно та которая нам и нужна.

Итак что же за параметры 
мы передаём этому методу? Первый параметер - это имя поля, второй
параметер - это значение поля, третий опции поиска (см. справку Дельфи). А что будет
если такого значения нет? Например:

    Table1.Locate('Category','Cod123',[loCaseInsensitive]);

Ничего не будет, правда метод Locate - это функция и она возвращает
значение Boolean в зависимости от того, найдена запись или нет.

Преобразовав код как

    if Table1.Locate('Category','Cod123',[loCaseInsensitive]) then
      showmessage('Record is located seccessful!')
    else
      showmessage('Record is not found!');

можно убедится, что теперь мы знаем найдена запись или нет. Можно искать
и по части значения, например

    Table1.Locate('Category','Co',[])

не сможет найти запись, а

    Table1.Locate('Category','Co',[loPartialKey])

вполне правильно найдёт запись с значением 'Cod'.

А если нам надо найти значение по двум полям? В этой таблице искать так
бесполезно, так как все поля разные. Переключим таблицу на другую. Для этого удалим
с формы все визуальные компоненты кроме DBGrid и DBNavigator (так как у новой
таблицы будет совсем другой список полей). В коде напишем что-то типа:

    Table1.active:=false; //закрыли таблицу
    Table1.tablename:='items.db';//ассоциируем с новой таблицей на диске
    Table1.active:=true; //открыли таблицу

Откомпилируем код, убедимся, что теперь мы видим совсем другую таблицу.

Теперь давайте найдём такую запись, где ItemNo=1 и Discount=50, для
этого нам надо применить Locate следующим образом:

    Table1.Locate('ItemNo;Discount',VarArrayOf([1,50]),[]);

Теперь несколько примечаний:

1. Для Дельфи 6/7 - добавьте "Uses Variants;"
2. Первый параметер - это список имён полей через ; без пробелов
3. Второй параметер - это массив вариант - значений полей. Почему
вариант? Потому что поля могут быть разных типов и в этом массиве вполне можно задать
значения разных типов: `VarArrayOf([1,'Вася', True, 3.14])`
